<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¨¡æ‹ŸçŸ­è§†é¢‘è°ƒç ”ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <style>
        :root {
            --douyin-red: #fe2c55;
            --douyin-black: #161823;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; height: 100%; background: #000; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica; }

        /* 1. é¡¶éƒ¨å¯¼èˆª */
        .nav-bar {
            position: fixed; top: 0; left: 0; width: 100%; height: 50px;
            display: flex; align-items: center; overflow-x: auto; 
            white-space: nowrap; z-index: 100; background: linear-gradient(to bottom, rgba(0,0,0,0.6), transparent);
            padding: 0 10px; scrollbar-width: none;
        }
        .nav-item {
            color: rgba(255,255,255,0.7); padding: 10px 15px; font-size: 16px; font-weight: bold; cursor: pointer;
        }
        .nav-item.active { color: #fff; border-bottom: 2px solid #fff; }

        /* 2. è§†é¢‘å®¹å™¨ */
        .swiper { width: 100%; height: 100%; }
        .swiper-slide { position: relative; background: #000; }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* 3. å³ä¾§äº¤äº’ */
        .side-bar {
            position: absolute; right: 10px; bottom: 150px; 
            display: flex; flex-direction: column; gap: 20px; z-index: 10;
        }
        .side-icon { text-align: center; color: #fff; font-size: 12px; }
        .icon-circle { width: 45px; height: 45px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 5px; }

        /* 4. å·¦ä¸‹è§’æ–‡æ¡ˆ */
        .bottom-info {
            position: absolute; left: 10px; bottom: 30px; width: 70%;
            color: #fff; z-index: 10; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .user-name { font-size: 17px; font-weight: bold; margin-bottom: 8px; }
        .video-desc { font-size: 14px; margin-bottom: 12px; line-height: 1.4; }
        .team-up-btn {
            display: inline-block; padding: 8px 16px; background: var(--douyin-red);
            border-radius: 20px; font-weight: bold; font-size: 14px; animation: pulse 2s infinite;
        }

        /* 5. å¼¹å¹•å±‚ */
        .danmaku-container { position: absolute; top: 80px; width: 100%; height: 200px; pointer-events: none; z-index: 5; }
        .danmaku-item {
            position: absolute; white-space: nowrap; color: #fff; text-shadow: 1px 1px 2px #000;
            font-size: 14px; animation: danmaku-move linear forwards;
        }

        /* 6. å¼¹çª—å…¬å…±æ ·å¼ */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center;
        }
        .modal-body { width: 85%; background: #fff; border-radius: 16px; padding: 25px; color: #333; }

        /* 7. åŒ¹é…åŠ¨ç”»æ ·å¼ */
        .matching-ui { text-align: center; color: #fff; }
        .radar {
            width: 120px; height: 120px; border: 2px solid var(--douyin-red); border-radius: 50%;
            margin: 0 auto 20px; position: relative; animation: radar-spin 2s linear infinite;
        }
        .radar::after { content: ''; position: absolute; top: 50%; left: 50%; width: 50%; height: 2px; background: var(--douyin-red); transform-origin: left center; }

        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes danmaku-move { from { transform: translateX(100vw); } to { transform: translateX(-150%); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes radar-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* é—®å·æ ·å¼ */
        .survey-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #000; }
        .survey-item { margin-bottom: 15px; }
        .survey-item label { display: block; margin: 8px 0; }
        .submit-btn { width: 100%; background: var(--douyin-red); color: #fff; border: none; padding: 12px; border-radius: 8px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="nav-bar" id="navBar">
        <div class="nav-item active" onclick="filterCategory('æ¨è', this)">æ¨è</div>
        <div class="nav-item" onclick="filterCategory('ç¾é£Ÿ', this)">ç¾é£Ÿ</div>
        <div class="nav-item" onclick="filterCategory('å­¦ä¹ ', this)">å­¦ä¹ </div>
        <div class="nav-item" onclick="filterCategory('æ—…è¡Œ', this)">æ—…è¡Œ</div>
        <div class="nav-item" onclick="filterCategory('æ¸¸æˆ', this)">æ¸¸æˆ</div>
        <div class="nav-item" onclick="filterCategory('æ ¡å›­ç”Ÿæ´»', this)">æ ¡å›­ç”Ÿæ´»</div>
    </div>

    <div class="swiper">
        <div class="swiper-wrapper" id="videoWrapper">
            </div>
    </div>

    <div id="surveyModal" class="modal">
        <div class="modal-body">
            <div class="survey-title">è§†é¢‘åé¦ˆè°ƒç ”</div>
            <div class="survey-item">
                <p>1. ä½ åˆšæ‰çœ‹åˆ°çš„è§†é¢‘å±äºå“ªä¸€ç±»ï¼Ÿ</p>
                <label><input type="radio" name="cat" value="ç¾é£Ÿ"> ç¾é£Ÿ</label>
                <label><input type="radio" name="cat" value="å­¦ä¹ "> å­¦ä¹ </label>
                <label><input type="radio" name="cat" value="æ—…è¡Œ"> æ—…è¡Œ</label>
                <label><input type="radio" name="cat" value="æ ¡å›­"> æ ¡å›­ç”Ÿæ´»</label>
            </div>
            <div class="survey-item">
                <p>2. ä½ å–œæ¬¢è¿™ä¸ªè§†é¢‘å—ï¼Ÿç†ç”±æ˜¯ï¼Ÿ</p>
                <textarea id="reason" style="width:100%; height:60px; border:1px solid #ddd; border-radius:4px;"></textarea>
            </div>
            <button class="submit-btn" onclick="submitSurvey()">æäº¤å¹¶ç»§ç»­è§‚çœ‹</button>
        </div>
    </div>

    <div id="matchModal" class="modal">
        <div id="matchingUI" class="matching-ui">
            <div class="radar"></div>
            <p>æ­£åœ¨åŒ¹é…é™„è¿‘çš„æ¢åº—é˜Ÿå‹...</p>
        </div>
        <div id="matchResult" class="modal-body" style="display:none; text-align:center;">
            <div style="font-size:40px;">ğŸ‰</div>
            <h3 style="margin:10px 0;">åŒ¹é…æˆåŠŸï¼</h3>
            <img id="m-avatar" src="" style="width:80px; height:80px; border-radius:50%; border:3px solid var(--douyin-red);">
            <p style="font-weight:bold; margin:10px 0;" id="m-name"></p>
            <p style="color:#666; font-size:13px;">åŒ¹é…åº¦ï¼š<span id="m-rate" style="color:var(--douyin-red)"></span></p>
            <button class="submit-btn" onclick="closeModal('matchModal')">å‘é€æ‰“æ‹›å‘¼</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        // 1. æ•°æ®å‡†å¤‡
        const videoData = [
            { id: 1, cat: "ç¾é£Ÿ", url: "01.mp4", user: "@å¤§èƒƒç‹å¼ºå“¥", desc: "è¿™å®¶çƒ¤è‚‰åº—æœ‰äººå»è¿‡å—ï¼Ÿæ±‚ç»„é˜Ÿï¼", danmaku: ["çœŸçš„å¥½åƒå—", "ç»„æˆ‘ä¸€ä¸ª", "åæ ‡å“ªé‡Œï¼Ÿ"], team: { name: "ç¾é£Ÿå®¶å°æ", rate: "98%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=1" } },
            { id: 2, cat: "å­¦ä¹ ", url: "02.mp4", user: "@å­¦éœ¸çŒ«", desc: "æ²‰æµ¸å¼å­¦ä¹ ï¼Œæœ‰äººä¸€èµ·è¿éº¦å—ï¼Ÿ", danmaku: ["åŠ æ²¹", "æ‰“å¡ç¬¬5å¤©", "è‡ªå¾‹èµ›é«˜"], team: { name: "è€ƒç ”å…šå°ç‹", rate: "92%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=2" } },
            { id: 3, cat: "æ—…è¡Œ", url: "03.mp4", user: "@æ—…è¡Œè¾¾äºº", desc: "è¿™é‡Œçš„é£æ™¯å¤ªç¾äº†ï¼", danmaku: ["å¥½æƒ³å»", "åœ¨å“ªé‡Œ", "æ±‚æ”»ç•¥"], team: { name: "æ—…è¡Œä¼™ä¼´å°å¼ ", rate: "95%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=3" } },
            { id: 4, cat: "æ¸¸æˆ", url: "04.mp4", user: "@ç”µç«å°‘å¹´", desc: "è°æ¥ä¸€èµ·å¼€é»‘ï¼Ÿ", danmaku: ["å¸¦æˆ‘", "æ®µä½å¤šå°‘", "åŠ å¥½å‹"], team: { name: "æ¸¸æˆé˜Ÿå‹å°åˆ˜", rate: "90%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=4" } },
            { id: 5, cat: "æ ¡å›­ç”Ÿæ´»", url: "05.mp4", user: "@æ ¡å›­vlog", desc: "å¤§å­¦ç”Ÿæ´»æ—¥å¸¸åˆ†äº«", danmaku: ["å¥½ç¾¡æ…•", "åŒæ ¡", "ç‚¹èµ"], team: { name: "åŒå­¦å°é™ˆ", rate: "94%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=5" } },
            { id: 6, cat: "ç¾é£Ÿ", url: "06.mp4", user: "@ç¾é£Ÿæ¢åº—", desc: "æ–°å¼€çš„å¥¶èŒ¶åº—è¶…å¥½å–ï¼", danmaku: ["åœ¨å“ªé‡Œ", "å¤šå°‘é’±", "æƒ³å–"], team: { name: "ç¾é£Ÿæ­å­å°å‘¨", rate: "97%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=6" } },
            { id: 7, cat: "å­¦ä¹ ", url: "07.mp4", user: "@è€ƒç ”ä¸Šå²¸", desc: "å¤‡è€ƒç»éªŒåˆ†äº«", danmaku: ["æ”¶è—äº†", "æœ‰ç”¨", "åŠ æ²¹"], team: { name: "å­¦ä¹ ä¼™ä¼´å°å­™", rate: "93%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=7" } },
        ];
        
        // è‡ªåŠ¨è¡¥å……åˆ°20ä¸ªè¿›è¡Œæµ‹è¯•ï¼ˆå¾ªç¯ä½¿ç”¨å‰7ä¸ªè§†é¢‘ï¼‰
        for(let i=8; i<=20; i++) {
            const baseVideo = videoData[(i-1) % 7];
            videoData.push({
                ...baseVideo, 
                id: i, 
                url: `0${((i-1) % 7) + 1}.mp4`,
                desc: `${baseVideo.desc}ï¼ˆè§†é¢‘ ${i}ï¼‰`
            });
        }

        let currentCategory = "æ¨è";
        let watchedCount = 0;
        let swiper;

        // 2. åˆå§‹åŒ–è§†é¢‘æµ
        function initSwiper(data) {
            const wrapper = document.getElementById('videoWrapper');
            wrapper.innerHTML = data.map((item, index) => `
                <div class="swiper-slide" data-id="${item.id}">
                    <video loop playsinline src="${item.url}" poster="https://via.placeholder.com/400x800/000000/FFFFFF?text=Loading..."></video>
                    <div class="danmaku-container"></div>
                    <div class="side-bar">
                        <div class="side-icon"><div class="icon-circle" onclick="this.style.color='var(--douyin-red)'">â¤ï¸</div><span>1.2w</span></div>
                        <div class="side-icon"><div class="icon-circle">ğŸ’¬</div><span>456</span></div>
                        <div class="side-icon"><div class="icon-circle">ğŸ”—</div><span>åˆ†äº«</span></div>
                    </div>
                    <div class="bottom-info">
                        <div class="user-name">${item.user}</div>
                        <div class="video-desc">${item.desc}</div>
                        <div class="team-up-btn" onclick="startMatch(${index})">ğŸ¤ ä¸€èµ·ç»„é˜Ÿæ¢åº—</div>
                    </div>
                </div>
            `).join('');

            if (swiper) swiper.destroy();
            swiper = new Swiper('.swiper', {
                direction: 'vertical',
                on: {
                    slideChange: function() {
                        const prevVideo = document.querySelectorAll('video')[this.previousIndex];
                        if(prevVideo) prevVideo.pause();
                        
                        const currentVideo = document.querySelectorAll('video')[this.activeIndex];
                        currentVideo.play();
                        
                        watchedCount++;
                        if(watchedCount % 5 === 0) {
                            currentVideo.pause();
                            document.getElementById('surveyModal').style.display = 'flex';
                        }
                        sendDanmaku(this.activeIndex);
                    }
                }
            });
            document.querySelectorAll('video')[0].play();
            sendDanmaku(0);
        }

        // 3. å¼¹å¹•åŠŸèƒ½
        function sendDanmaku(index) {
            const container = document.querySelectorAll('.danmaku-container')[index];
            const texts = videoData[index % videoData.length].danmaku;
            setInterval(() => {
                if(swiper.activeIndex !== index) return;
                const span = document.createElement('span');
                span.className = 'danmaku-item';
                span.innerText = texts[Math.floor(Math.random()*texts.length)];
                span.style.top = Math.random() * 150 + 'px';
                span.style.animationDuration = (Math.random() * 3 + 4) + 's';
                container.appendChild(span);
                setTimeout(() => span.remove(), 7000);
            }, 2000);
        }

        // 4. æ¨¡æ‹ŸåŒ¹é…é€»è¾‘
        function startMatch(index) {
            const video = document.querySelectorAll('video')[swiper.activeIndex];
            video.pause();
            const modal = document.getElementById('matchModal');
            const ui = document.getElementById('matchingUI');
            const res = document.getElementById('matchResult');
            
            modal.style.display = 'flex';
            ui.style.display = 'block';
            res.style.display = 'none';

            // æ¨¡æ‹Ÿ2.5ç§’åŒ¹é…è¿‡ç¨‹
            setTimeout(() => {
                const teammate = videoData[index % videoData.length].team;
                document.getElementById('m-name').innerText = teammate.name;
                document.getElementById('m-rate').innerText = teammate.rate;
                document.getElementById('m-avatar').src = teammate.avatar;
                ui.style.display = 'none';
                res.style.display = 'block';
            }, 2500);
        }

        // 5. è¾…åŠ©åŠŸèƒ½
        function filterCategory(cat, el) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            const filtered = cat === "æ¨è" ? videoData : videoData.filter(v => v.cat === cat);
            initSwiper(filtered);
        }

        function submitSurvey() {
            const data = {
                cat: document.querySelector('input[name="cat"]:checked')?.value,
                reason: document.getElementById('reason').value,
                time: new Date().toLocaleString()
            };
            console.log("è°ƒç ”æ•°æ®å·²å­˜å…¥æœ¬åœ°:", data);
            localStorage.setItem('survey_' + Date.now(), JSON.stringify(data));
            closeModal('surveyModal');
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
            document.querySelectorAll('video')[swiper.activeIndex].play();
        }

        // å¯åŠ¨
        initSwiper(videoData);
    </script>
</body>
</html>