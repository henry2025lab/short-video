<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¨¡æ‹ŸçŸ­è§†é¢‘è°ƒç ”ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <style>
        :root {
            --douyin-red: #fe2c55;
            --douyin-black: #161823;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; height: 100%; background: #000; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica; }

        /* 1. é¡¶éƒ¨å¯¼èˆª */
        .nav-bar {
            position: fixed; top: 0; left: 0; width: 100%; height: 50px;
            display: flex; align-items: center; overflow-x: auto; 
            white-space: nowrap; z-index: 100; background: linear-gradient(to bottom, rgba(0,0,0,0.6), transparent);
            padding: 0 10px; scrollbar-width: none;
        }
        .nav-item {
            color: rgba(255,255,255,0.7); padding: 10px 15px; font-size: 16px; font-weight: bold; cursor: pointer;
        }
        .nav-item.active { color: #fff; border-bottom: 2px solid #fff; }

        /* 2. è§†é¢‘å®¹å™¨ */
        .swiper { width: 100%; height: 100%; }
        .swiper-slide { position: relative; background: #000; }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* 3. å³ä¾§äº¤äº’ */
        .side-bar {
            position: absolute; right: 10px; bottom: 150px; 
            display: flex; flex-direction: column; gap: 20px; z-index: 10;
        }
        .side-icon { text-align: center; color: #fff; font-size: 12px; }
        .icon-circle { width: 45px; height: 45px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 5px; cursor: pointer; transition: all 0.3s; }
        .icon-circle.liked { color: var(--douyin-red); background: rgba(254,44,85,0.3); }
        .icon-circle:hover { background: rgba(255,255,255,0.3); transform: scale(1.1); }
        .comment-item { padding:10px 0; border-bottom:1px solid #eee; }
        .comment-item:last-child { border-bottom:none; }
        .comment-user { font-weight:bold; color:#333; margin-bottom:5px; }
        .comment-content { color:#666; font-size:14px; }
        .comment-time { color:#999; font-size:12px; margin-top:5px; }

        /* 4. å·¦ä¸‹è§’æ–‡æ¡ˆ */
        .bottom-info {
            position: absolute; left: 10px; bottom: 30px; width: 70%;
            color: #fff; z-index: 10; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .user-name { font-size: 17px; font-weight: bold; margin-bottom: 8px; }
        .video-desc { font-size: 14px; margin-bottom: 12px; line-height: 1.4; }
        .team-up-btn {
            display: inline-block; padding: 8px 16px; background: var(--douyin-red);
            border-radius: 20px; font-weight: bold; font-size: 14px; animation: pulse 2s infinite;
        }

        /* 5. å¼¹å¹•å±‚ */
        .danmaku-container { position: absolute; top: 80px; width: 100%; height: 200px; pointer-events: none; z-index: 5; }
        .danmaku-item {
            position: absolute; white-space: nowrap; color: #fff; text-shadow: 1px 1px 2px #000;
            font-size: 14px; animation: danmaku-move linear forwards;
        }

        /* 6. å¼¹çª—å…¬å…±æ ·å¼ */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center;
        }
        .modal-body { width: 85%; background: #fff; border-radius: 16px; padding: 25px; color: #333; }

        /* 7. åŒ¹é…åŠ¨ç”»æ ·å¼ */
        .matching-ui { text-align: center; color: #fff; }
        .radar {
            width: 120px; height: 120px; border: 2px solid var(--douyin-red); border-radius: 50%;
            margin: 0 auto 20px; position: relative; animation: radar-spin 2s linear infinite;
        }
        .radar::after { content: ''; position: absolute; top: 50%; left: 50%; width: 50%; height: 2px; background: var(--douyin-red); transform-origin: left center; }

        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes danmaku-move { from { transform: translateX(100vw); } to { transform: translateX(-150%); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes radar-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* é—®å·æ ·å¼ */
        .survey-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #000; }
        .survey-item { margin-bottom: 15px; }
        .survey-item label { display: block; margin: 8px 0; }
        .submit-btn { width: 100%; background: var(--douyin-red); color: #fff; border: none; padding: 12px; border-radius: 8px; font-weight: bold; }

        /* æ¡Œé¢ç«¯å“åº”å¼ä¼˜åŒ– */
        @media (min-width: 768px) {
            body {
                display: flex;
                justify-content: center;
                align-items: center;
                background: #000;
            }
            
            .swiper {
                max-width: 450px; /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œä¿æŒ9:16æ¯”ä¾‹ */
                height: 100vh;
                margin: 0 auto;
            }
            
            .swiper-slide {
                background: #000;
            }
            
            video {
                width: 100%;
                height: 100%;
                object-fit: contain; /* æ”¹ä¸ºcontainï¼Œä¿æŒæ¯”ä¾‹ä¸è£å‰ª */
            }
            
            /* å¯¼èˆªæ åœ¨æ¡Œé¢ç«¯ä¹Ÿéœ€è¦å±…ä¸­ */
            .nav-bar {
                max-width: 450px;
                left: 50%;
                transform: translateX(-50%);
            }
        }
    </style>
</head>
<body>

    <div class="nav-bar" id="navBar">
        <div class="nav-item active" onclick="filterCategory('æ¨è', this)">æ¨è</div>
        <div class="nav-item" onclick="filterCategory('ç¾é£Ÿ', this)">ç¾é£Ÿ</div>
        <div class="nav-item" onclick="filterCategory('å­¦ä¹ ', this)">å­¦ä¹ </div>
        <div class="nav-item" onclick="filterCategory('æ—…è¡Œ', this)">æ—…è¡Œ</div>
        <div class="nav-item" onclick="filterCategory('æ¸¸æˆ', this)">æ¸¸æˆ</div>
        <div class="nav-item" onclick="filterCategory('æ ¡å›­ç”Ÿæ´»', this)">æ ¡å›­ç”Ÿæ´»</div>
    </div>

    <div class="swiper">
        <div class="swiper-wrapper" id="videoWrapper">
            </div>
    </div>

    <div id="surveyModal" class="modal">
        <div class="modal-body">
            <div class="survey-title">è§†é¢‘åé¦ˆè°ƒç ”</div>
            <div class="survey-item">
                <p>1. ä½ åˆšæ‰çœ‹åˆ°çš„è§†é¢‘å±äºå“ªä¸€ç±»ï¼Ÿ</p>
                <label><input type="radio" name="cat" value="ç¾é£Ÿ"> ç¾é£Ÿ</label>
                <label><input type="radio" name="cat" value="å­¦ä¹ "> å­¦ä¹ </label>
                <label><input type="radio" name="cat" value="æ—…è¡Œ"> æ—…è¡Œ</label>
                <label><input type="radio" name="cat" value="æ ¡å›­"> æ ¡å›­ç”Ÿæ´»</label>
            </div>
            <div class="survey-item">
                <p>2. ä½ å–œæ¬¢è¿™ä¸ªè§†é¢‘å—ï¼Ÿç†ç”±æ˜¯ï¼Ÿ</p>
                <textarea id="reason" style="width:100%; height:60px; border:1px solid #ddd; border-radius:4px;"></textarea>
            </div>
            <button class="submit-btn" onclick="submitSurvey()">æäº¤å¹¶ç»§ç»­è§‚çœ‹</button>
        </div>
    </div>

    <div id="matchModal" class="modal">
        <div id="matchingUI" class="matching-ui">
            <div class="radar"></div>
            <p>æ­£åœ¨åŒ¹é…é™„è¿‘çš„æ¢åº—é˜Ÿå‹...</p>
        </div>
        <div id="matchResult" class="modal-body" style="display:none; text-align:center;">
            <div style="font-size:40px;">ğŸ‰</div>
            <h3 style="margin:10px 0;">åŒ¹é…æˆåŠŸï¼</h3>
            <img id="m-avatar" src="" style="width:80px; height:80px; border-radius:50%; border:3px solid var(--douyin-red);">
            <p style="font-weight:bold; margin:10px 0;" id="m-name"></p>
            <p style="color:#666; font-size:13px;">åŒ¹é…åº¦ï¼š<span id="m-rate" style="color:var(--douyin-red)"></span></p>
            <button class="submit-btn" onclick="closeModal('matchModal')">å‘é€æ‰“æ‹›å‘¼</button>
        </div>
    </div>

    <div id="commentModal" class="modal">
        <div class="modal-body" style="max-height:80vh; overflow-y:auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <div class="survey-title">è¯„è®º</div>
                <button onclick="closeModal('commentModal')" style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
            </div>
            <div id="commentsList" style="margin-bottom:20px; max-height:400px; overflow-y:auto;">
                <!-- è¯„è®ºåˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            </div>
            <div style="border-top:1px solid #eee; padding-top:15px;">
                <textarea id="newComment" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." style="width:100%; height:60px; border:1px solid #ddd; border-radius:4px; padding:8px; margin-bottom:10px;"></textarea>
                <button class="submit-btn" onclick="addComment()">å‘å¸ƒè¯„è®º</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        // 1. æ•°æ®å‡†å¤‡ - 20ä¸ªè§†é¢‘ï¼Œæ¯ä¸ªåˆ†ç±»4ä¸ª
        const videoData = [
            // ç¾é£Ÿç±» (4ä¸ª)
            { id: 1, cat: "ç¾é£Ÿ", url: "https://videos.pexels.com/video-files/3045163/3045163-hd_1920_1080_25fps.mp4", user: "@chef chen", desc: "çˆ±åƒ å¥½åƒ #æ¾³é—¨#æ¾³é—¨ç¾é£Ÿ#æ¾³é—¨æ—…æ¸¸#æ¾³é—¨æ—…æ¸¸æ”»ç•¥", danmaku: ["çœ‹èµ·æ¥å¾ˆå¥½åƒ", "åœ¨å“ªé‡Œ", "å¤šå°‘é’±", "æƒ³å»è¯•è¯•"], team: { name: "ç¾é£Ÿæ¢åº—å›¢", rate: "95%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=1" } },
            { id: 2, cat: "ç¾é£Ÿ", url: "https://videos.pexels.com/video-files/3045163/3045163-hd_1920_1080_25fps.mp4", user: "@ç¾é£Ÿåšä¸»å°A", desc: "ä»Šå¤©åšäº†è¶…å¥½åƒçš„çº¢çƒ§è‚‰ï¼ä½ ä»¬æƒ³å­¦å—ï¼Ÿ#ç¾é£Ÿæ•™ç¨‹#å®¶å¸¸èœ", danmaku: ["çœ‹èµ·æ¥å¾ˆå¥½åƒ", "æ±‚æ•™ç¨‹", "å¤ªé¦™äº†", "æ”¶è—äº†"], team: { name: "ç¾é£Ÿè¾¾äºº", rate: "93%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=2" } },
            { id: 3, cat: "ç¾é£Ÿ", url: "https://videos.pexels.com/video-files/3045163/3045163-hd_1920_1080_25fps.mp4", user: "@ç”œå“æ§", desc: "è¿™å®¶åº—çš„ææ‹‰ç±³è‹ç»äº†ï¼å…¥å£å³åŒ– #ç”œå“#ä¸‹åˆèŒ¶#æ¢åº—", danmaku: ["åœ¨å“ªé‡Œ", "å¤šå°‘é’±", "æƒ³å»è¯•è¯•", "å¤ªè¯±äººäº†"], team: { name: "ç”œå“çˆ±å¥½è€…", rate: "96%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=3" } },
            { id: 4, cat: "ç¾é£Ÿ", url: "https://videos.pexels.com/video-files/3045163/3045163-hd_1920_1080_25fps.mp4", user: "@æ·±å¤œé£Ÿå ‚", desc: "æ·±å¤œä¸€ç¢—çƒ­è…¾è…¾çš„æ‹‰é¢ï¼Œæ²»æ„ˆä¸€åˆ‡ #å¤œå®µ#æ‹‰é¢#ç¾é£Ÿ", danmaku: ["çœ‹èµ·æ¥å¾ˆå¥½åƒ", "é¥¿äº†", "æ±‚åœ°å€", "å¤ªé¦™äº†"], team: { name: "å¤œå®µæ­å­", rate: "94%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=4" } },
            
            // å­¦ä¹ ç±» (4ä¸ª)
            { id: 5, cat: "å­¦ä¹ ", url: "https://videos.pexels.com/video-files/2491284/2491284-hd_1920_1080_25fps.mp4", user: "@Hadeså’Œ33", desc: "ä¸ç®¡æœ‰å¤šéš¾,éƒ½æ˜¯å€¼å¾—çš„!ç»§ç»­åŠªåŠ›! #çƒ­é—¨æ³•å­¦é™¢æ¯•ä¸šç”Ÿ #æ³•å¾‹ç³»å­¦ç”Ÿ #å­¦ä¹ åŠ¨æœº#åŠ±å¿—è§†é¢‘", danmaku: ["åŠ æ²¹", "æ”¶è—äº†", "å¾ˆæœ‰ç”¨", "å…±å‹‰"], team: { name: "å­¦ä¹ ä¼™ä¼´", rate: "92%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=5" } },
            { id: 6, cat: "å­¦ä¹ ", url: "https://videos.pexels.com/video-files/2491284/2491284-hd_1920_1080_25fps.mp4", user: "@è€ƒç ”ä¸Šå²¸", desc: "æ¯å¤©5ç‚¹èµ·åºŠå­¦ä¹ ï¼ŒåšæŒå°±æ˜¯èƒœåˆ©ï¼ #è€ƒç ”#è‡ªå¾‹#å­¦ä¹ æ‰“å¡", danmaku: ["åŠ æ²¹", "ä¸è¦æ”¾å¼ƒ", "åšæŒ", "å…±å‹‰"], team: { name: "è€ƒç ”æˆ˜å‹", rate: "91%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=6" } },
            { id: 7, cat: "å­¦ä¹ ", url: "https://videos.pexels.com/video-files/2491284/2491284-hd_1920_1080_25fps.mp4", user: "@å­¦éœ¸ç¬”è®°", desc: "åˆ†äº«æˆ‘çš„é«˜æ•ˆå­¦ä¹ æ–¹æ³•ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ© #å­¦ä¹ æ–¹æ³•#æ•ˆç‡#å­¦ä¹ æŠ€å·§", danmaku: ["æ”¶è—äº†", "å¾ˆæœ‰ç”¨", "å­¦åˆ°äº†", "æ„Ÿè°¢åˆ†äº«"], team: { name: "å­¦ä¹ å°ç»„", rate: "93%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=7" } },
            { id: 8, cat: "å­¦ä¹ ", url: "https://videos.pexels.com/video-files/2491284/2491284-hd_1920_1080_25fps.mp4", user: "@è‹±è¯­å­¦ä¹ ", desc: "æ¯å¤©10ä¸ªå•è¯ï¼Œä¸€å¹´å°±æ˜¯3650ä¸ªï¼åšæŒå°±æ˜¯èƒœåˆ© #è‹±è¯­å­¦ä¹ #å•è¯#æ‰“å¡", danmaku: ["åŠ æ²¹", "æ”¶è—äº†", "å¾ˆæœ‰ç”¨", "ä¸€èµ·å­¦ä¹ "], team: { name: "è‹±è¯­å­¦ä¹ ç»„", rate: "90%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=8" } },
            
            // æ—…è¡Œç±» (4ä¸ª)
            { id: 9, cat: "æ—…è¡Œ", url: "01_æ—…è¡Œ.mp4", user: "@æ¢é¬¼é¬¼", desc: "é•¿è¿™ä¹ˆå¤§ç¬¬ä¸€æ¬¡è§æ˜æ˜Ÿ æœ¬äººè¿˜æŒºæ¼‚äº®çš„#æ¨è¶…è¶Š", danmaku: ["å¥½æƒ³å»", "æ”»ç•¥æ”¶è—", "å¤ªç¾äº†", "æ±‚åœ°å€"], team: { name: "è¿½æ˜Ÿå°åˆ†é˜Ÿ", rate: "96%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=9" } },
            { id: 10, cat: "æ—…è¡Œ", url: "05_æ—…è¡Œ.mp4", user: "@é‡Šè¿¦çš„æ‚...", desc: "ç¬¬28é›†|è¯„æµ‹:æ¾³é—¨å„å¤§èµŒåœºçš„è¹­åƒå–èµ°ä¸€éäº†,å¦‚æœåªæ˜¯ä¸ºäº†è¹­åƒå–,äººè¯¥æ˜¯ç›´å¥”ç¾...", danmaku: ["å¥½æƒ³å»", "æ”»ç•¥æ”¶è—", "æƒ³å»", "å¤ªå®ç”¨äº†"], team: { name: "æ—…è¡Œæ”»ç•¥ç»„", rate: "94%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=10" } },
            { id: 11, cat: "æ—…è¡Œ", url: "07_æ—…è¡Œ.mp4", user: "@çŒªä¸½è€¶", desc: "å¿«æ¥ç æµ·é•¿éš†æµ·æ´‹ç‹å›½å§,ç°åœ¨æœ‰395ä¸¤ä¸ªäººçš„é—¨ç¥¨,åˆ«é”™è¿‡äº†~#ç æµ·é•¿éš†æµ·æ´‹ç‹å›½ #ç æµ·...", danmaku: ["å¥½æƒ³å»", "åˆ’ç®—", "å·²ä¹°ç¥¨", "æ±‚æ”»ç•¥"], team: { name: "æ—…è¡Œæ­å­", rate: "97%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=11" } },
            { id: 12, cat: "æ—…è¡Œ", url: "https://videos.pexels.com/video-files/2491284/2491284-hd_1920_1080_25fps.mp4", user: "@æ—…è¡Œæ—¥è®°", desc: "å¤§ç†çš„æ´±æµ·çœŸçš„å¤ªç¾äº†ï¼æ¯ä¸€å¸§éƒ½æ˜¯å£çº¸ #å¤§ç†#æ´±æµ·#æ—…è¡Œ#äº‘å—", danmaku: ["å¥½æƒ³å»", "æ”»ç•¥æ”¶è—", "å¤ªç¾äº†", "æ±‚åœ°å€"], team: { name: "æ—…è¡Œä¼™ä¼´", rate: "95%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=12" } },
            
            // æ¸¸æˆç±» (4ä¸ª)
            { id: 13, cat: "æ¸¸æˆ", url: "https://videos.pexels.com/video-files/3045163/3045163-hd_1920_1080_25fps.mp4", user: "@ç”µç«å°‘å¹´", desc: "äº”æ€ï¼è¿™æ³¢æ“ä½œæ€ä¹ˆæ ·ï¼Ÿ#ç‹è€…è£è€€#äº”æ€#æ¸¸æˆ", danmaku: ["å¸¦æˆ‘", "å‰å®³", "åŠ å¥½å‹", "ä¸€èµ·ç©"], team: { name: "æ¸¸æˆé˜Ÿå‹", rate: "90%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=13" } },
            { id: 14, cat: "æ¸¸æˆ", url: "https://videos.pexels.com/video-files/3045163/3045163-hd_1920_1080_25fps.mp4", user: "@æ¸¸æˆä¸»æ’­", desc: "æ–°èµ›å­£ä¸Šåˆ†æ”»ç•¥ï¼Œçœ‹å®Œå°±èƒ½ä¸Šç‹è€…ï¼ #æ¸¸æˆæ”»ç•¥#ä¸Šåˆ†#æŠ€å·§", danmaku: ["å¸¦æˆ‘", "å‰å®³", "å­¦åˆ°äº†", "ä¸€èµ·ç©"], team: { name: "ä¸Šåˆ†å°é˜Ÿ", rate: "92%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=14" } },
            { id: 15, cat: "æ¸¸æˆ", url: "https://videos.pexels.com/video-files/3045163/3045163-hd_1920_1080_25fps.mp4", user: "@æ¸¸æˆè¾¾äºº", desc: "è¿™ä¸ªæ¸¸æˆå¤ªå¥½ç©äº†ï¼æœ‰äººä¸€èµ·ç»„é˜Ÿå—ï¼Ÿ #æ–°æ¸¸æˆ#ç»„é˜Ÿ#æ¸¸æˆæ¨è", danmaku: ["å¸¦æˆ‘", "åŠ å¥½å‹", "ä¸€èµ·ç©", "æ±‚å¸¦"], team: { name: "æ¸¸æˆæˆ˜é˜Ÿ", rate: "88%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=15" } },
            { id: 16, cat: "æ¸¸æˆ", url: "https://videos.pexels.com/video-files/3045163/3045163-hd_1920_1080_25fps.mp4", user: "@æ¸¸æˆè§£è¯´", desc: "è¿™æ³¢æ“ä½œç»†èŠ‚æ‹‰æ»¡ï¼ä½ ä»¬å­¦ä¼šäº†å—ï¼Ÿ #æ¸¸æˆæŠ€å·§#æ•™å­¦#æ“ä½œ", danmaku: ["å‰å®³", "å­¦åˆ°äº†", "æ”¶è—äº†", "å¤ªå¼ºäº†"], team: { name: "æŠ€æœ¯æµ", rate: "94%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=16" } },
            
            // æ ¡å›­ç”Ÿæ´»ç±» (4ä¸ª)
            { id: 17, cat: "æ ¡å›­ç”Ÿæ´»", url: "02_æ ¡å›­ç”Ÿæ´».mp4", user: "@Elma.Z", desc: "è¿™å“¥ä»¬å„¿åœ¨å¹²å˜›", danmaku: ["åŒæ ¡", "å¥½ç¾¡æ…•", "ç‚¹èµ", "æ”¯æŒ"], team: { name: "æ ¡å›­è½¦å‹", rate: "88%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=17" } },
            { id: 18, cat: "æ ¡å›­ç”Ÿæ´»", url: "06_æ ¡å›­ç”Ÿæ´».mp4", user: "@é»„èŠ±èœ", desc: "ä¸Šæµ·å•†èµ›#å•†èµ›#å•†ä¸šæ¨¡æ‹ŸæŒ‘æˆ˜èµ› #CEO", danmaku: ["åŒæ ¡", "å¥½ç¾¡æ…•", "ç‚¹èµ", "æ”¯æŒ"], team: { name: "å•†èµ›é˜Ÿå‹", rate: "90%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=18" } },
            { id: 19, cat: "æ ¡å›­ç”Ÿæ´»", url: "https://videos.pexels.com/video-files/2491284/2491284-hd_1920_1080_25fps.mp4", user: "@æ ¡å›­vlog", desc: "å¤§å­¦ç”Ÿæ´»æ—¥å¸¸åˆ†äº«ï¼Œè®°å½•ç¾å¥½æ—¶å…‰ #æ ¡å›­ç”Ÿæ´»#vlog#æ—¥å¸¸", danmaku: ["åŒæ ¡", "å¥½ç¾¡æ…•", "ç‚¹èµ", "æ”¯æŒ"], team: { name: "æ ¡å›­ä¼™ä¼´", rate: "92%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=19" } },
            { id: 20, cat: "æ ¡å›­ç”Ÿæ´»", url: "https://videos.pexels.com/video-files/2491284/2491284-hd_1920_1080_25fps.mp4", user: "@å­¦ç”Ÿä¼š", desc: "æ ¡å›­æ´»åŠ¨ç²¾å½©ç¬é—´ï¼Œå¤§å®¶ä¸€èµ·å‚ä¸ï¼ #æ ¡å›­æ´»åŠ¨#ç¤¾å›¢#é’æ˜¥", danmaku: ["åŒæ ¡", "å¥½ç¾¡æ…•", "ç‚¹èµ", "æ”¯æŒ"], team: { name: "æ´»åŠ¨ç»„ç»‡", rate: "89%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=20" } },
        ];
        
        // è§†é¢‘ç»Ÿè®¡æ•°æ®ï¼ˆä»APIåŠ è½½ï¼Œè¿™é‡Œå…ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰
        let videoStats = {};
        let videoComments = {};

        let currentCategory = "æ¨è";
        let watchedCount = 0;
        let swiper;

        // 2. åˆå§‹åŒ–è§†é¢‘æµ
        function initSwiper(data) {
            const wrapper = document.getElementById('videoWrapper');
            wrapper.innerHTML = data.map((item, index) => {
                const videoId = item.id;
                const stats = videoStats[videoId] || { likes: Math.floor(Math.random() * 5000) + 1000, comments: Math.floor(Math.random() * 200) + 50, shares: Math.floor(Math.random() * 300) + 100 };
                const isLiked = localStorage.getItem(`liked_${videoId}`) === 'true';
                return `
                <div class="swiper-slide" data-id="${videoId}">
                    <video loop playsinline src="${item.url}" poster="https://via.placeholder.com/400x800/000000/FFFFFF?text=Loading..."></video>
                    <div class="danmaku-container"></div>
                    <div class="side-bar">
                        <div class="side-icon">
                            <div class="icon-circle ${isLiked ? 'liked' : ''}" onclick="toggleLike(${videoId}, ${index})" id="likeBtn_${videoId}">â¤ï¸</div>
                            <span id="likeCount_${videoId}">${formatCount(stats.likes)}</span>
                        </div>
                        <div class="side-icon">
                            <div class="icon-circle" onclick="showComments(${videoId})">ğŸ’¬</div>
                            <span id="commentCount_${videoId}">${formatCount(stats.comments)}</span>
                        </div>
                        <div class="side-icon">
                            <div class="icon-circle" onclick="shareVideo(${videoId})">ğŸ”—</div>
                            <span id="shareCount_${videoId}">${formatCount(stats.shares)}</span>
                        </div>
                    </div>
                    <div class="bottom-info">
                        <div class="user-name">${item.user}</div>
                        <div class="video-desc">${item.desc}</div>
                        <div class="team-up-btn" onclick="startMatch(${index})">ğŸ¤ ä¸€èµ·ç»„é˜Ÿæ¢åº—</div>
                    </div>
                </div>
            `;
            }).join('');

            if (swiper) swiper.destroy();
            swiper = new Swiper('.swiper', {
                direction: 'vertical',
                on: {
                    slideChange: function() {
                        const prevVideo = document.querySelectorAll('video')[this.previousIndex];
                        if(prevVideo) prevVideo.pause();
                        
                        const currentVideo = document.querySelectorAll('video')[this.activeIndex];
                        currentVideo.play();
                        
                        watchedCount++;
                        if(watchedCount % 5 === 0) {
                            currentVideo.pause();
                            document.getElementById('surveyModal').style.display = 'flex';
                        }
                        sendDanmaku(this.activeIndex);
                    }
                }
            });
            document.querySelectorAll('video')[0].play();
            sendDanmaku(0);
        }

        // 3. å¼¹å¹•åŠŸèƒ½
        function sendDanmaku(index) {
            const container = document.querySelectorAll('.danmaku-container')[index];
            const texts = videoData[index % videoData.length].danmaku;
            setInterval(() => {
                if(swiper.activeIndex !== index) return;
                const span = document.createElement('span');
                span.className = 'danmaku-item';
                span.innerText = texts[Math.floor(Math.random()*texts.length)];
                span.style.top = Math.random() * 150 + 'px';
                span.style.animationDuration = (Math.random() * 3 + 4) + 's';
                container.appendChild(span);
                setTimeout(() => span.remove(), 7000);
            }, 2000);
        }

        // 4. æ¨¡æ‹ŸåŒ¹é…é€»è¾‘
        function startMatch(index) {
            const video = document.querySelectorAll('video')[swiper.activeIndex];
            video.pause();
            const modal = document.getElementById('matchModal');
            const ui = document.getElementById('matchingUI');
            const res = document.getElementById('matchResult');
            
            modal.style.display = 'flex';
            ui.style.display = 'block';
            res.style.display = 'none';

            // æ¨¡æ‹Ÿ2.5ç§’åŒ¹é…è¿‡ç¨‹
            setTimeout(() => {
                const teammate = videoData[index % videoData.length].team;
                document.getElementById('m-name').innerText = teammate.name;
                document.getElementById('m-rate').innerText = teammate.rate;
                document.getElementById('m-avatar').src = teammate.avatar;
                ui.style.display = 'none';
                res.style.display = 'block';
            }, 2500);
        }

        // 5. è¾…åŠ©åŠŸèƒ½
        function filterCategory(cat, el) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            const filtered = cat === "æ¨è" ? videoData : videoData.filter(v => v.cat === cat);
            initSwiper(filtered);
        }

        function submitSurvey() {
            const data = {
                cat: document.querySelector('input[name="cat"]:checked')?.value,
                reason: document.getElementById('reason').value,
                time: new Date().toLocaleString()
            };
            console.log("è°ƒç ”æ•°æ®å·²å­˜å…¥æœ¬åœ°:", data);
            localStorage.setItem('survey_' + Date.now(), JSON.stringify(data));
            closeModal('surveyModal');
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
            if (swiper && swiper.activeIndex !== undefined) {
                const videos = document.querySelectorAll('video');
                if (videos[swiper.activeIndex]) {
                    videos[swiper.activeIndex].play();
                }
            }
        }

        // æ ¼å¼åŒ–æ•°å­—æ˜¾ç¤º
        function formatCount(count) {
            if (count >= 10000) {
                return (count / 10000).toFixed(1) + 'w';
            } else if (count >= 1000) {
                return (count / 1000).toFixed(1) + 'k';
            }
            return count.toString();
        }

        // ç‚¹èµåŠŸèƒ½
        async function toggleLike(videoId, index) {
            const btn = document.getElementById(`likeBtn_${videoId}`);
            const countEl = document.getElementById(`likeCount_${videoId}`);
            const isLiked = btn.classList.contains('liked');
            
            // ä¹è§‚æ›´æ–°UI
            if (isLiked) {
                btn.classList.remove('liked');
                const currentCount = videoStats[videoId]?.likes || 0;
                videoStats[videoId] = { ...videoStats[videoId], likes: Math.max(0, currentCount - 1) };
            } else {
                btn.classList.add('liked');
                const currentCount = videoStats[videoId]?.likes || 0;
                videoStats[videoId] = { ...videoStats[videoId], likes: currentCount + 1 };
                localStorage.setItem(`liked_${videoId}`, 'true');
            }
            countEl.textContent = formatCount(videoStats[videoId].likes);
            
            // è°ƒç”¨APIæ›´æ–°æ•°æ®åº“
            try {
                const response = await fetch(`/api/likes/${videoId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: isLiked ? 'unlike' : 'like' })
                });
                if (response.ok) {
                    const data = await response.json();
                    videoStats[videoId] = data.stats;
                    countEl.textContent = formatCount(data.stats.likes);
                }
            } catch (error) {
                console.error('ç‚¹èµå¤±è´¥:', error);
                // å¤±è´¥æ—¶å›æ»š
                if (isLiked) {
                    btn.classList.add('liked');
                } else {
                    btn.classList.remove('liked');
                    localStorage.removeItem(`liked_${videoId}`);
                }
            }
        }

        // æ˜¾ç¤ºè¯„è®º
        async function showComments(videoId) {
            const modal = document.getElementById('commentModal');
            const commentsList = document.getElementById('commentsList');
            modal.style.display = 'flex';
            
            // åŠ è½½è¯„è®º
            try {
                const response = await fetch(`/api/comments/${videoId}`);
                if (response.ok) {
                    const data = await response.json();
                    videoComments[videoId] = data.comments;
                    renderComments(videoId);
                } else {
                    // å¦‚æœAPIå¤±è´¥ï¼Œä½¿ç”¨é¢„è®¾è¯„è®º
                    renderComments(videoId);
                }
            } catch (error) {
                console.error('åŠ è½½è¯„è®ºå¤±è´¥:', error);
                renderComments(videoId);
            }
        }

        // æ¸²æŸ“è¯„è®ºåˆ—è¡¨
        function renderComments(videoId) {
            const commentsList = document.getElementById('commentsList');
            const comments = videoComments[videoId] || [];
            const video = videoData.find(v => v.id === videoId);
            
            // å¦‚æœæ²¡æœ‰è¯„è®ºï¼Œæ˜¾ç¤ºé¢„è®¾è¯„è®º
            if (comments.length === 0 && video) {
                const presetComments = getPresetComments(video.cat);
                commentsList.innerHTML = presetComments.map((comment, idx) => `
                    <div class="comment-item">
                        <div class="comment-user">@ç”¨æˆ·${idx + 1}</div>
                        <div class="comment-content">${comment}</div>
                        <div class="comment-time">${getTimeAgo(idx)}</div>
                    </div>
                `).join('');
            } else {
                commentsList.innerHTML = comments.map(comment => `
                    <div class="comment-item">
                        <div class="comment-user">${comment.user_name || '@åŒ¿åç”¨æˆ·'}</div>
                        <div class="comment-content">${comment.content}</div>
                        <div class="comment-time">${formatTime(comment.created_at)}</div>
                    </div>
                `).join('');
            }
        }

        // è·å–é¢„è®¾è¯„è®º
        function getPresetComments(category) {
            const presets = {
                'ç¾é£Ÿ': ["çœ‹èµ·æ¥å¾ˆå¥½åƒ", "åœ¨å“ªé‡Œ", "å¤šå°‘é’±", "æƒ³å»è¯•è¯•"],
                'å­¦ä¹ ': ["åŠ æ²¹", "æ”¶è—äº†", "å¾ˆæœ‰ç”¨", "å…±å‹‰"],
                'æ—…è¡Œ': ["å¥½æƒ³å»", "æ”»ç•¥æ”¶è—", "å¤ªç¾äº†", "æ±‚åœ°å€"],
                'æ¸¸æˆ': ["å¸¦æˆ‘", "å‰å®³", "åŠ å¥½å‹", "ä¸€èµ·ç©"],
                'æ ¡å›­ç”Ÿæ´»': ["åŒæ ¡", "å¥½ç¾¡æ…•", "ç‚¹èµ", "æ”¯æŒ"]
            };
            return presets[category] || ["ä¸é”™", "ç‚¹èµ", "æ”¯æŒ", "åŠ æ²¹"];
        }

        // æ·»åŠ è¯„è®º
        async function addComment() {
            const input = document.getElementById('newComment');
            const content = input.value.trim();
            if (!content) return;
            
            const currentVideo = videoData[swiper.activeIndex];
            const videoId = currentVideo.id;
            
            // ä¹è§‚æ›´æ–°UI
            const newComment = {
                id: Date.now(),
                video_id: videoId,
                content: content,
                user_name: '@æ¸¸å®¢' + Math.floor(Math.random() * 1000),
                created_at: new Date().toISOString()
            };
            
            if (!videoComments[videoId]) {
                videoComments[videoId] = [];
            }
            videoComments[videoId].push(newComment);
            renderComments(videoId);
            input.value = '';
            
            // æ›´æ–°è¯„è®ºæ•°
            const countEl = document.getElementById(`commentCount_${videoId}`);
            if (countEl) {
                const currentCount = videoStats[videoId]?.comments || 0;
                videoStats[videoId] = { ...videoStats[videoId], comments: currentCount + 1 };
                countEl.textContent = formatCount(videoStats[videoId].comments);
            }
            
            // è°ƒç”¨APIä¿å­˜è¯„è®º
            try {
                const response = await fetch(`/api/comments/${videoId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content: content })
                });
                if (response.ok) {
                    const data = await response.json();
                    videoComments[videoId] = data.comments;
                    renderComments(videoId);
                }
            } catch (error) {
                console.error('æ·»åŠ è¯„è®ºå¤±è´¥:', error);
            }
        }

        // åˆ†äº«åŠŸèƒ½
        async function shareVideo(videoId) {
            const shareUrl = 'https://short-video-1hg1.vercel.app/';
            const video = videoData.find(v => v.id === videoId);
            const shareText = `${video?.desc || 'åˆ†äº«ä¸€ä¸ªæœ‰è¶£çš„è§†é¢‘'}`;
            
            // ä½¿ç”¨ Web Share APIï¼ˆç§»åŠ¨ç«¯ï¼‰
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'çŸ­è§†é¢‘åˆ†äº«',
                        text: shareText,
                        url: shareUrl
                    });
                    await updateShareCount(videoId);
                } catch (error) {
                    if (error.name !== 'AbortError') {
                        // å¦‚æœåˆ†äº«å¤±è´¥ï¼Œå¤åˆ¶é“¾æ¥
                        copyToClipboard(shareUrl);
                    }
                }
            } else {
                // æ¡Œé¢ç«¯ï¼šå¤åˆ¶é“¾æ¥
                copyToClipboard(shareUrl);
                await updateShareCount(videoId);
            }
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                });
            } else {
                // é™çº§æ–¹æ¡ˆ
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }
        }

        // æ›´æ–°åˆ†äº«æ•°
        async function updateShareCount(videoId) {
            const countEl = document.getElementById(`shareCount_${videoId}`);
            if (countEl) {
                const currentCount = videoStats[videoId]?.shares || 0;
                videoStats[videoId] = { ...videoStats[videoId], shares: currentCount + 1 };
                countEl.textContent = formatCount(videoStats[videoId].shares);
            }
            
            try {
                await fetch(`/api/shares/${videoId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
            } catch (error) {
                console.error('æ›´æ–°åˆ†äº«æ•°å¤±è´¥:', error);
            }
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(timeString) {
            if (!timeString) return 'åˆšåˆš';
            const time = new Date(timeString);
            const now = new Date();
            const diff = now - time;
            const minutes = Math.floor(diff / 60000);
            if (minutes < 1) return 'åˆšåˆš';
            if (minutes < 60) return `${minutes}åˆ†é’Ÿå‰`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}å°æ—¶å‰`;
            const days = Math.floor(hours / 24);
            return `${days}å¤©å‰`;
        }

        function getTimeAgo(index) {
            const times = ['åˆšåˆš', '5åˆ†é’Ÿå‰', '1å°æ—¶å‰', '2å°æ—¶å‰'];
            return times[index] || 'åˆšåˆš';
        }

        // åŠ è½½è§†é¢‘ç»Ÿè®¡æ•°æ®
        async function loadVideoStats() {
            try {
                const response = await fetch('/api/videos/stats');
                if (response.ok) {
                    const data = await response.json();
                    videoStats = data.stats || {};
                }
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
            }
        }

        // å¯åŠ¨
        loadVideoStats().then(() => {
            initSwiper(videoData);
        });
    </script>
</body>
</html>