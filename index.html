<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¨¡æ‹ŸçŸ­è§†é¢‘è°ƒç ”ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <style>
        :root {
            --douyin-red: #fe2c55;
            --douyin-black: #161823;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; height: 100%; background: #000; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica; }

        /* 1. é¡¶éƒ¨å¯¼èˆª */
        .nav-bar {
            position: fixed; top: 0; left: 0; width: 100%; height: 50px;
            display: flex; align-items: center; overflow-x: auto; 
            white-space: nowrap; z-index: 100; background: linear-gradient(to bottom, rgba(0,0,0,0.6), transparent);
            padding: 0 10px; scrollbar-width: none;
        }
        .nav-item {
            color: rgba(255,255,255,0.7); padding: 10px 15px; font-size: 16px; font-weight: bold; cursor: pointer;
        }
        .nav-item.active { color: #fff; border-bottom: 2px solid #fff; }

        /* 2. è§†é¢‘å®¹å™¨ */
        .swiper { width: 100%; height: 100%; }
        .swiper-slide { position: relative; background: #000; }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* 3. å³ä¾§äº¤äº’ */
        .side-bar {
            position: absolute; right: 10px; bottom: 150px; 
            display: flex; flex-direction: column; gap: 20px; z-index: 10;
        }
        .side-icon { text-align: center; color: #fff; font-size: 12px; }
        .icon-circle { width: 45px; height: 45px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 5px; }

        /* 4. å·¦ä¸‹è§’æ–‡æ¡ˆ */
        .bottom-info {
            position: absolute; left: 10px; bottom: 30px; width: 70%;
            color: #fff; z-index: 10; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .user-name { font-size: 17px; font-weight: bold; margin-bottom: 8px; }
        .video-desc { font-size: 14px; margin-bottom: 12px; line-height: 1.4; }
        .team-up-btn {
            display: inline-block; padding: 8px 16px; background: var(--douyin-red);
            border-radius: 20px; font-weight: bold; font-size: 14px; animation: pulse 2s infinite;
        }

        /* 5. å¼¹å¹•å±‚ */
        .danmaku-container { position: absolute; top: 80px; width: 100%; height: 200px; pointer-events: none; z-index: 5; }
        .danmaku-item {
            position: absolute; white-space: nowrap; color: #fff; text-shadow: 1px 1px 2px #000;
            font-size: 14px; animation: danmaku-move linear forwards;
        }

        /* 6. å¼¹çª—å…¬å…±æ ·å¼ */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center;
        }
        .modal-body { width: 85%; background: #fff; border-radius: 16px; padding: 25px; color: #333; }

        /* 7. åŒ¹é…åŠ¨ç”»æ ·å¼ */
        .matching-ui { text-align: center; color: #fff; }
        .radar {
            width: 120px; height: 120px; border: 2px solid var(--douyin-red); border-radius: 50%;
            margin: 0 auto 20px; position: relative; animation: radar-spin 2s linear infinite;
        }
        .radar::after { content: ''; position: absolute; top: 50%; left: 50%; width: 50%; height: 2px; background: var(--douyin-red); transform-origin: left center; }

        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes danmaku-move { from { transform: translateX(100vw); } to { transform: translateX(-150%); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes radar-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* é—®å·æ ·å¼ */
        .survey-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #000; }
        .survey-item { margin-bottom: 15px; }
        .survey-item label { display: block; margin: 8px 0; }
        .submit-btn { width: 100%; background: var(--douyin-red); color: #fff; border: none; padding: 12px; border-radius: 8px; font-weight: bold; }

        /* æ¡Œé¢ç«¯å“åº”å¼ä¼˜åŒ– */
        @media (min-width: 768px) {
            body {
                display: flex;
                justify-content: center;
                align-items: center;
                background: #000;
            }
            
            .swiper {
                max-width: 450px; /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œä¿æŒ9:16æ¯”ä¾‹ */
                height: 100vh;
                margin: 0 auto;
            }
            
            .swiper-slide {
                background: #000;
            }
            
            video {
                width: 100%;
                height: 100%;
                object-fit: contain; /* æ”¹ä¸ºcontainï¼Œä¿æŒæ¯”ä¾‹ä¸è£å‰ª */
            }
            
            /* å¯¼èˆªæ åœ¨æ¡Œé¢ç«¯ä¹Ÿéœ€è¦å±…ä¸­ */
            .nav-bar {
                max-width: 450px;
                left: 50%;
                transform: translateX(-50%);
            }
        }
    </style>
</head>
<body>

    <div class="nav-bar" id="navBar">
        <div class="nav-item active" onclick="filterCategory('æ¨è', this)">æ¨è</div>
        <div class="nav-item" onclick="filterCategory('ç¾é£Ÿ', this)">ç¾é£Ÿ</div>
        <div class="nav-item" onclick="filterCategory('å­¦ä¹ ', this)">å­¦ä¹ </div>
        <div class="nav-item" onclick="filterCategory('æ—…è¡Œ', this)">æ—…è¡Œ</div>
        <div class="nav-item" onclick="filterCategory('æ¸¸æˆ', this)">æ¸¸æˆ</div>
        <div class="nav-item" onclick="filterCategory('æ ¡å›­ç”Ÿæ´»', this)">æ ¡å›­ç”Ÿæ´»</div>
    </div>

    <div class="swiper">
        <div class="swiper-wrapper" id="videoWrapper">
            </div>
    </div>

    <div id="surveyModal" class="modal">
        <div class="modal-body">
            <div class="survey-title">è§†é¢‘åé¦ˆè°ƒç ”</div>
            <div class="survey-item">
                <p>1. ä½ åˆšæ‰çœ‹åˆ°çš„è§†é¢‘å±äºå“ªä¸€ç±»ï¼Ÿ</p>
                <label><input type="radio" name="cat" value="ç¾é£Ÿ"> ç¾é£Ÿ</label>
                <label><input type="radio" name="cat" value="å­¦ä¹ "> å­¦ä¹ </label>
                <label><input type="radio" name="cat" value="æ—…è¡Œ"> æ—…è¡Œ</label>
                <label><input type="radio" name="cat" value="æ ¡å›­"> æ ¡å›­ç”Ÿæ´»</label>
            </div>
            <div class="survey-item">
                <p>2. ä½ å–œæ¬¢è¿™ä¸ªè§†é¢‘å—ï¼Ÿç†ç”±æ˜¯ï¼Ÿ</p>
                <textarea id="reason" style="width:100%; height:60px; border:1px solid #ddd; border-radius:4px;"></textarea>
            </div>
            <button class="submit-btn" onclick="submitSurvey()">æäº¤å¹¶ç»§ç»­è§‚çœ‹</button>
        </div>
    </div>

    <div id="matchModal" class="modal">
        <div id="matchingUI" class="matching-ui">
            <div class="radar"></div>
            <p>æ­£åœ¨åŒ¹é…é™„è¿‘çš„æ¢åº—é˜Ÿå‹...</p>
        </div>
        <div id="matchResult" class="modal-body" style="display:none; text-align:center;">
            <div style="font-size:40px;">ğŸ‰</div>
            <h3 style="margin:10px 0;">åŒ¹é…æˆåŠŸï¼</h3>
            <img id="m-avatar" src="" style="width:80px; height:80px; border-radius:50%; border:3px solid var(--douyin-red);">
            <p style="font-weight:bold; margin:10px 0;" id="m-name"></p>
            <p style="color:#666; font-size:13px;">åŒ¹é…åº¦ï¼š<span id="m-rate" style="color:var(--douyin-red)"></span></p>
            <button class="submit-btn" onclick="closeModal('matchModal')">å‘é€æ‰“æ‹›å‘¼</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        // 1. æ•°æ®å‡†å¤‡
        const videoData = [
            { id: 1, cat: "æ—…è¡Œ", url: "01_æ—…è¡Œ.mp4", user: "@æ¢é¬¼é¬¼", desc: "é•¿è¿™ä¹ˆå¤§ç¬¬ä¸€æ¬¡è§æ˜æ˜Ÿ æœ¬äººè¿˜æŒºæ¼‚äº®çš„#æ¨è¶…è¶Š", danmaku: ["çœŸçš„å‡çš„", "åœ¨å“ªé‡Œ", "å¥½ç¾¡æ…•", "æœ¬äººå¥½çœ‹å—"], team: { name: "è¿½æ˜Ÿå°åˆ†é˜Ÿ", rate: "96%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=1" } },
            { id: 2, cat: "æ ¡å›­ç”Ÿæ´»", url: "02_æ ¡å›­ç”Ÿæ´».mp4", user: "@Elma.Z", desc: "è¿™å“¥ä»¬å„¿åœ¨å¹²å˜›", danmaku: ["å¡ä½äº†", "ç†„ç«", "å´©æºƒå‘€ ğŸ˜‚", "ä¸¤è„šç¦»åˆ", "æ²¡æ°”äº†"], team: { name: "æ ¡å›­è½¦å‹", rate: "88%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=2" } },
            { id: 3, cat: "ç¾é£Ÿ", url: "03_ç¾é£Ÿ.mp4", user: "@chef chen", desc: "çˆ±åƒ å¥½åƒ #æ¾³é—¨#æ¾³é—¨ç¾é£Ÿ#æ¾³é—¨æ—…æ¸¸#æ¾³é—¨æ—…æ¸¸æ”»ç•¥", danmaku: ["çœ‹èµ·æ¥ä¸é”™", "åœ¨å“ªé‡Œ", "å¤šå°‘é’±", "æƒ³å»"], team: { name: "ç¾é£Ÿæ¢åº—å›¢", rate: "95%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=3" } },
            { id: 4, cat: "å­¦ä¹ ", url: "04_å­¦ä¹ .mp4", user: "@Hadeså’Œ33", desc: "ä¸ç®¡æœ‰å¤šéš¾,éƒ½æ˜¯å€¼å¾—çš„!ç»§ç»­åŠªåŠ›! #çƒ­é—¨æ³•å­¦é™¢æ¯•ä¸šç”Ÿ #æ³•å¾‹ç³»å­¦ç”Ÿ #å­¦ä¹ åŠ¨æœº#åŠ±å¿—è§†é¢‘", danmaku: ["åŠ æ²¹", "ä¸è¦æ”¾å¼ƒ", "åšæŒ", "å…±å‹‰"], team: { name: "å­¦ä¹ ä¼™ä¼´", rate: "92%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=4" } },
            { id: 5, cat: "æ—…è¡Œ", url: "05_æ—…è¡Œ.mp4", user: "@é‡Šè¿¦çš„æ‚...", desc: "ç¬¬28é›†|è¯„æµ‹:æ¾³é—¨å„å¤§èµŒåœºçš„è¹­åƒå–èµ°ä¸€éäº†,å¦‚æœåªæ˜¯ä¸ºäº†è¹­åƒå–,äººè¯¥æ˜¯ç›´å¥”ç¾...", danmaku: ["çœŸçš„å…è´¹å—", "æ”»ç•¥æ”¶è—", "æƒ³å»", "å¤ªå®ç”¨äº†"], team: { name: "æ—…è¡Œæ”»ç•¥ç»„", rate: "94%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=5" } },
            { id: 6, cat: "æ ¡å›­ç”Ÿæ´»", url: "06_æ ¡å›­ç”Ÿæ´».mp4", user: "@é»„èŠ±èœ", desc: "ä¸Šæµ·å•†èµ›#å•†èµ›#å•†ä¸šæ¨¡æ‹ŸæŒ‘æˆ˜èµ› #CEO", danmaku: ["æ­å–œ", "å‰å®³", "æ€ä¹ˆå‚åŠ ", "æ±‚ç»éªŒ"], team: { name: "å•†èµ›é˜Ÿå‹", rate: "90%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=6" } },
            { id: 7, cat: "æ—…è¡Œ", url: "07_æ—…è¡Œ.mp4", user: "@çŒªä¸½è€¶", desc: "å¿«æ¥ç æµ·é•¿éš†æµ·æ´‹ç‹å›½å§,ç°åœ¨æœ‰395ä¸¤ä¸ªäººçš„é—¨ç¥¨,åˆ«é”™è¿‡äº†~#ç æµ·é•¿éš†æµ·æ´‹ç‹å›½ #ç æµ·...", danmaku: ["å¥½æƒ³å»", "åˆ’ç®—", "å·²ä¹°ç¥¨", "æ±‚æ”»ç•¥"], team: { name: "æ—…è¡Œæ­å­", rate: "97%", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=7" } },
        ];

        let currentCategory = "æ¨è";
        let watchedCount = 0;
        let swiper;

        // 2. åˆå§‹åŒ–è§†é¢‘æµ
        function initSwiper(data) {
            const wrapper = document.getElementById('videoWrapper');
            wrapper.innerHTML = data.map((item, index) => `
                <div class="swiper-slide" data-id="${item.id}">
                    <video loop playsinline src="${item.url}" poster="https://via.placeholder.com/400x800/000000/FFFFFF?text=Loading..."></video>
                    <div class="danmaku-container"></div>
                    <div class="side-bar">
                        <div class="side-icon"><div class="icon-circle" onclick="this.style.color='var(--douyin-red)'">â¤ï¸</div><span>1.2w</span></div>
                        <div class="side-icon"><div class="icon-circle">ğŸ’¬</div><span>456</span></div>
                        <div class="side-icon"><div class="icon-circle">ğŸ”—</div><span>åˆ†äº«</span></div>
                    </div>
                    <div class="bottom-info">
                        <div class="user-name">${item.user}</div>
                        <div class="video-desc">${item.desc}</div>
                        <div class="team-up-btn" onclick="startMatch(${index})">ğŸ¤ ä¸€èµ·ç»„é˜Ÿæ¢åº—</div>
                    </div>
                </div>
            `).join('');

            if (swiper) swiper.destroy();
            swiper = new Swiper('.swiper', {
                direction: 'vertical',
                on: {
                    slideChange: function() {
                        const prevVideo = document.querySelectorAll('video')[this.previousIndex];
                        if(prevVideo) prevVideo.pause();
                        
                        const currentVideo = document.querySelectorAll('video')[this.activeIndex];
                        currentVideo.play();
                        
                        watchedCount++;
                        if(watchedCount % 5 === 0) {
                            currentVideo.pause();
                            document.getElementById('surveyModal').style.display = 'flex';
                        }
                        sendDanmaku(this.activeIndex);
                    }
                }
            });
            document.querySelectorAll('video')[0].play();
            sendDanmaku(0);
        }

        // 3. å¼¹å¹•åŠŸèƒ½
        function sendDanmaku(index) {
            const container = document.querySelectorAll('.danmaku-container')[index];
            const texts = videoData[index % videoData.length].danmaku;
            setInterval(() => {
                if(swiper.activeIndex !== index) return;
                const span = document.createElement('span');
                span.className = 'danmaku-item';
                span.innerText = texts[Math.floor(Math.random()*texts.length)];
                span.style.top = Math.random() * 150 + 'px';
                span.style.animationDuration = (Math.random() * 3 + 4) + 's';
                container.appendChild(span);
                setTimeout(() => span.remove(), 7000);
            }, 2000);
        }

        // 4. æ¨¡æ‹ŸåŒ¹é…é€»è¾‘
        function startMatch(index) {
            const video = document.querySelectorAll('video')[swiper.activeIndex];
            video.pause();
            const modal = document.getElementById('matchModal');
            const ui = document.getElementById('matchingUI');
            const res = document.getElementById('matchResult');
            
            modal.style.display = 'flex';
            ui.style.display = 'block';
            res.style.display = 'none';

            // æ¨¡æ‹Ÿ2.5ç§’åŒ¹é…è¿‡ç¨‹
            setTimeout(() => {
                const teammate = videoData[index % videoData.length].team;
                document.getElementById('m-name').innerText = teammate.name;
                document.getElementById('m-rate').innerText = teammate.rate;
                document.getElementById('m-avatar').src = teammate.avatar;
                ui.style.display = 'none';
                res.style.display = 'block';
            }, 2500);
        }

        // 5. è¾…åŠ©åŠŸèƒ½
        function filterCategory(cat, el) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            const filtered = cat === "æ¨è" ? videoData : videoData.filter(v => v.cat === cat);
            initSwiper(filtered);
        }

        function submitSurvey() {
            const data = {
                cat: document.querySelector('input[name="cat"]:checked')?.value,
                reason: document.getElementById('reason').value,
                time: new Date().toLocaleString()
            };
            console.log("è°ƒç ”æ•°æ®å·²å­˜å…¥æœ¬åœ°:", data);
            localStorage.setItem('survey_' + Date.now(), JSON.stringify(data));
            closeModal('surveyModal');
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
            document.querySelectorAll('video')[swiper.activeIndex].play();
        }

        // å¯åŠ¨
        initSwiper(videoData);
    </script>
</body>
</html>